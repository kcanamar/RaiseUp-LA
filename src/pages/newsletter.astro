---
import { getCollection } from "astro:content";
import Layout from "../layouts/page.astro"

// TODO SANITY.io data.newsletter collection
const newsletters = await getCollection('newsletter')
---
<Layout>
    <!-- Newest Three Newsletters Section -->
    <section class="text-gray-600 body-font">
        <div class="container px-5 py-24 mx-auto">

            <div class="flex justify-center mb-6">
                <h1 class="text-center border-b-2 border-blue-300 text-yellow-500 sm:text-3xl text-2xl font-medium title-font mb-4 pb-4 w-1/2">
                    Hot Off The Press
                </h1>
            </div>
            <div class="flex flex-wrap -mx-4 -my-8">
                {
                    newsletters.slice(0,3).map((letter) => {
                        return (
                            <div class="p-4 md:w-1/3">
                                <article class="h-full border-2 border-gray-200 border-opacity-60 rounded-lg overflow-hidden">
                                    <img class="lg:h-48 md:h-36 w-full object-cover object-center" src={letter.data.image || "https://dummyimage.com/722x402"} alt="blog">
                                    <a href={`/newsletter/${letter.slug}`}>
                                        <div class="p-6">
                                            <h2 class="tracking-widest text-xs title-font font-medium text-yellow-500 mb-1">
                                                {letter.data?.category || "CATEGORY"}    
                                            </h2>
                                            <h1 class="title-font text-lg font-medium text-gray-900 mb-3">
                                                {letter.data.title}
                                            </h1>
                                            <p class="leading-relaxed mb-3">
                                                {letter.data.description}
                                            </p>
                                            <div class="flex items-center flex-wrap">
                                                <span class="text-blue-500 inline-flex items-center md:mb-2 lg:mb-0">Read On
                                                    <svg class="w-4 h-4 ml-2" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M5 12h14"></path>
                                                    <path d="M12 5l7 7-7 7"></path>
                                                    </svg>
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                </article>
                            </div>
                        )
                    })
                }
            </div>
        </div>
    </section>

    <!-- Newsletter History Section -->
    <section class="text-gray-400 body-font">
        <div class="container px-5 py-24 mx-auto text-center sm:text-left">
            <div class="flex justify-center">
                <h1 class="text-center border-b-2 border-blue-300 text-yellow-500 sm:text-3xl text-2xl font-medium title-font mb-4 pb-4 w-1/2">
                    All Newsletters
                </h1>
            </div>
            <div class="my-6 divide-y-2 divide-gray-100">
                {
                    // TODO: filter by date && filter by category
                    newsletters.slice(3).map((letter) => {
                        return (
                            <div class="py-8 px-2 my-2 flex flex-col sm:flex-row">
                                <div class="md:w-64 sm:w-48 sm:mb-0 mb-6 flex-shrink-0 flex flex-col">
                                    <span class="font-semibold title-font text-gray-700">{letter.data?.category || "Category"}</span>
                                    <span class="mt-1 text-gray-500 text-sm">
                                        <time datetime={letter.data.date.toISOString()}>
                                            {letter.data.date.toDateString()}
                                        </time>
                                    </span>
                                </div>
                                <div class="md:flex-grow">
                                    <h2 class="text-2xl font-medium text-gray-900 title-font mb-2">
                                        <a href={`/newsletter/${letter.slug}`}>{letter.data.title}</a>
                                    </h2>
                                    <p class="leading-relaxed">
                                        {letter.data.description}
                                    </p>
                                    <a class="text-blue-500 inline-flex items-center mt-4" href={`/blog/${letter.slug}`} rel={`/blog/${letter.slug}`}>
                                        Learn More
                                        <svg class="w-4 h-4 ml-2" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M5 12h14"></path>
                                            <path d="M12 5l7 7-7 7"></path>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        )
                    })
                }
            </div>
        </div>
    </section>
</Layout>

